[build-system]
requires = ["setuptools>=42", "wheel"]
build-backend = "setuptools.build_meta"

[project]
name = "chatspatial"
version = "0.1.0"
description = "ChatSpatial: An interactive AI assistant for spatial transcriptomics analysis"
requires-python = ">=3.8"
dependencies = [
    "mcp",
    "numpy",
    "pandas",
    "matplotlib",
    "scanpy",
    "squidpy",  # 空间转录组分析包
    "anndata",
    "scikit-learn",
    "click",
    "pydantic>=2.0.0",
    "scvelo",  # RNA速率分析
    "cellrank",  # 轨迹分析和细胞命运映射
    "umap-learn",  # 降维
    "scipy",  # 科学计算
    "igraph",  # 图分析
    "leidenalg",  # 聚类算法
    "harmonypy",  # 批次效应校正
    "bbknn",  # 批次平衡的KNN
    "scanorama",  # 多样本整合
    # HTTP server dependencies
    "fastapi",  # Web framework
    "uvicorn[standard]",  # ASGI server
    "aiohttp",  # HTTP client library
]

[project.optional-dependencies]
enrichmap = [
    # EnrichMap specific dependencies
    "statannotations",
    "pygam",
    "scikit-gstat",
    "adjustText",
    "splot",
    "dask==2024.11.2",
]
deconvolution = [
    "cell2location",  # 空间转录组去卷积
    "torch>=1.7.1",  # 用于cell2location
]
cell2location = [
    "cell2location",  # 空间转录组去卷积
    "torch>=1.7.1",  # 用于cell2location
]
spatial_domains = [
    "STAGATE",  # 空间域识别
    "SpaGCN",  # 空间域识别
    "tensorflow>=1.15.0,<2.0",  # STAGATE依赖
    "torch>=1.7.1",  # SpaGCN依赖
    "opencv-python",  # SpaGCN图像处理
    "scikit-learn",  # 空间域细化
]
spatial_genes = [
    "spatialde",  # 空间变异基因识别
    "NaiveDE",  # SpatialDE依赖的数据预处理
    "patsy",  # NaiveDE依赖
]
cell_communication = [
    "liana",  # LIANA+ 细胞通讯分析
    "scipy",  # LIANA+ 科学计算依赖
    "tqdm",  # LIANA+ 进度条
]
all = [
    # EnrichMap dependencies
    "statannotations",
    "pygam",
    "scikit-gstat",
    "adjustText",
    "splot",
    "dask==2024.11.2",
    # Deconvolution dependencies
    "cell2location",
    # Spatial domain dependencies
    "STAGATE",
    "SpaGCN",
    # Spatial genes dependencies  
    "spatialde",
    "NaiveDE",
    # Cell communication dependencies
    "liana",
    # Common dependencies
    "torch>=1.7.1",
    "pyro-ppl>=1.8.0",
    "tensorflow>=1.15.0,<2.0",
    "opencv-python",
    "tqdm",
    "scikit-learn",
    "patsy",
]

[project.scripts]
chatspatial = "chatspatial.__main__:main"
chatspatial-http = "chatspatial.http_server:main"

[tool.pytest.ini_options]
minversion = "6.0"
testpaths = ["tests"]
python_files = "test_*.py"
python_classes = "Test*"
python_functions = "test_*"
addopts = "-v"
# Fix pytest-asyncio warning
asyncio_mode = "auto"
asyncio_default_fixture_loop_scope = "function"